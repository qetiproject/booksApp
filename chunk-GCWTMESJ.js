import"./chunk-HSN2MZQI.js";import{a as je}from"./chunk-ZJAB7DQ2.js";import{a as Qe,b as qe}from"./chunk-T63SHC32.js";import{a as Ue}from"./chunk-MG6AAN6L.js";import{a as Ye}from"./chunk-5RK3PXXJ.js";import"./chunk-7OVFYEO6.js";import{a as Ge}from"./chunk-EUVBYMWW.js";import"./chunk-CIHP2GYC.js";import"./chunk-J7COVTUU.js";import"./chunk-WAKTGZJV.js";import"./chunk-XMIKUBPV.js";import{A as Ke,C as Y,D as Ne,E as Le,F as P,G as $e,H as W,I as O,K as w,j as Me,l as Be,p as De,t as oe,w as Oe,x as Ve}from"./chunk-UEIXULZA.js";import"./chunk-UZQL7P7K.js";import{$b as S,Ab as N,Bb as M,Cb as B,Da as le,Db as v,Eb as f,Fb as h,Gb as k,Hb as d,Ib as p,Ic as Re,Jb as ge,Kb as he,Kc as Ie,Lb as we,Mb as z,Mc as Fe,Nb as L,Nc as Ae,O as se,Ob as xe,Pb as E,Pc as I,Qb as X,R as me,Rb as _,Sa as de,Tb as $,Ua as m,Ub as j,Vb as G,Wb as Z,Yb as Te,Za as pe,Zb as l,_b as D,ac as Ee,d as u,e as x,f as R,fc as _e,hc as ye,ia as q,ib as g,ic as Ce,jc as ee,kb as ce,kc as ke,lc as Se,n as ie,na as b,nb as ue,nc as te,rc as U,s as ne,t as re,ta as F,ua as A,uc as Q,vc as y,wb as ve,yb as fe,z as ae,zb as be}from"./chunk-FHDIX2EK.js";var Pe=(()=>{let e=class e{constructor(){this.addToFavourites=Q(),this.addToCatalogue=Q()}addToCatalogueEvent(){this.addToCatalogue.emit()}addToFavouritesEvent(){this.addToFavourites.emit()}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=g({type:e,selectors:[["app-book-actions"]],outputs:{addToFavourites:"addToFavourites",addToCatalogue:"addToCatalogue"},decls:9,vars:0,consts:[[1,"mt-6","mb-6","flex","flex-wrap","gap-3"],[1,"inline-flex","items-center","gap-2","px-6","py-2.5","rounded-lg","bg-pink-50","text-pink-700","text-sm","font-medium","border","border-pink-200","hover:bg-pink-100","transition","shadow-sm",3,"click"],[1,"material-icons","text-pink-600"],[1,"inline-flex","items-center","gap-2","px-6","py-2.5","rounded-lg","bg-slate-50","text-slate-800","text-sm","font-medium","border","border-slate-200","hover:bg-slate-100","transition","shadow-sm",3,"click"],[1,"material-icons","text-slate-600"]],template:function(r,o){r&1&&(d(0,"div",0)(1,"button",1),X("click",function(){return o.addToFavouritesEvent()}),d(2,"span",2),l(3,"favorite"),p(),l(4," Add to Favourites "),p(),d(5,"button",3),X("click",function(){return o.addToCatalogueEvent()}),d(6,"span",4),l(7,"library_add"),p(),l(8," Add to Catalogue "),p()())},encapsulation:2});let t=e;return t})();function it(t,e){if(t&1&&(d(0,"span",2),l(1),p()),t&2){let i=e.$implicit;m(),S(" ",i," ")}}function nt(t,e){if(t&1&&(d(0,"span",5),l(1),p()),t&2){let i=e.$implicit;m(),S(" ",i," ")}}var We=(()=>{let e=class e{constructor(){this.book=y.required(),this.authorList=U(()=>this.book().volumeInfo.authors??[]),this.categoryList=U(()=>this.book().volumeInfo.categories??[])}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=g({type:e,selectors:[["app-book-content"]],inputs:{book:[1,"book"]},decls:10,vars:2,consts:[[1,"text-3xl","font-extrabold","text-slate-900"],[1,"mt-6","flex","flex-wrap","gap-2"],[1,"px-3","py-1","text-sm","font-medium","bg-blue-100","text-blue-800","rounded-full"],[1,"mt-4","text-slate-700","leading-relaxed","text-sm","md:text-base"],[1,"mt-5","flex","flex-wrap","gap-2"],[1,"px-2.5","py-1","text-xs","font-semibold","bg-green-100","text-green-700","rounded-full"]],template:function(r,o){r&1&&(d(0,"h1",0),l(1),p(),d(2,"div",1),M(3,it,2,1,"span",2,N),p(),d(5,"p",3),l(6),p(),d(7,"div",4),M(8,nt,2,1,"span",5,N),p()),r&2&&(m(),S(" ",o.book().volumeInfo.title,`
`),m(2),B(o.authorList()),m(3),S(" ",o.book().volumeInfo.description,`
`),m(2),B(o.categoryList()))},encapsulation:2});let t=e;return t})();var He=(()=>{let e=class e{constructor(){this.book=y.required(),this.thumbnail=U(()=>this.book().volumeInfo.imageLinks?.thumbnail||this.book().volumeInfo.imageLinks?.smallThumbnail||"assets/default-thumbnail.png")}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=g({type:e,selectors:[["app-book-info"]],hostAttrs:[1,"md:w-1/3","bg-slate-50","p-6","flex","flex-col","items-center","md:items-start"],inputs:{book:[1,"book"]},decls:23,vars:6,consts:[[1,"w-full"],["loading","lazy",1,"w-full","h-auto","object-cover","rounded-lg","shadow-md",3,"src","alt"],[1,"sr-only"],[1,"mt-6","w-full"],[1,"text-lg","font-semibold","text-slate-900","mb-3"],[1,"space-y-2","text-sm","text-slate-700"],[1,"flex","justify-between"],[1,"font-medium","text-slate-900"],[1,"uppercase"]],template:function(r,o){r&1&&(d(0,"figure",0),ge(1,"img",1),d(2,"figcaption",2),l(3),p()(),d(4,"section",3)(5,"h2",4),l(6,"Book details"),p(),d(7,"ul",5)(8,"li",6)(9,"span",7),l(10,"Publisher:"),p(),d(11,"span"),l(12),p()(),d(13,"li",6)(14,"span",7),l(15,"Pages:"),p(),d(16,"span"),l(17),p()(),d(18,"li",6)(19,"span",7),l(20,"Language:"),p(),d(21,"span",8),l(22),p()()()()),r&2&&(m(),xe("src",o.thumbnail(),de)("alt",o.book().volumeInfo.title),m(2),S(" ",o.book().volumeInfo.title," "),m(9),D(o.book().volumeInfo.publisher),m(5),D(o.book().volumeInfo.pageCount),m(5),D(o.book().volumeInfo.language))},encapsulation:2});let t=e;return t})();var V={BOOK_API:"https://www.googleapis.com/books/v1/volumes",CATALOGUE_STORAGE_KEY:"booksIncatalogue",FAVOURITE_STORAGE_KEY:"favouriteBooks",USER_STORAGE_KEY:"user",AUTH_API:"https://dummyjson.com/auth",ACCESS_TOKEN_KEY:"accessToken",REFRESH_TOKEN_KEY:"refreshToken",BOOK_REVIEWS:"BOOK_REVIEWS"};function Je(t){let e=sessionStorage.getItem(V.BOOK_REVIEWS);return(e?JSON.parse(e):null)?.some(n=>n.bookId===t)}var H=(()=>{let e=class e{constructor(){this.REVIEWS_KEY=V.BOOK_REVIEWS,this.reviews=new ie([]),this.reviews$=this.reviews.asObservable(),this.reviews.next(this.loadReviews())}loadReviews(){let n=sessionStorage.getItem(this.REVIEWS_KEY);return n?JSON.parse(n):[]}loadReviewsByBookid(n){return this.reviews$.pipe(ae(r=>r.filter(o=>o.bookId===n)))}addReview(n){let r=this.reviews.value,o=[n,...r];return this.reviews.next(o),sessionStorage.setItem(this.REVIEWS_KEY,JSON.stringify(o)),re(!0)}};e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=q({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();function ze(t){return t.nonNullable.group({comment:t.nonNullable.control("",[oe.maxLength(500),oe.required]),star:t.nonNullable.control(0)})}var at=()=>[1,2,3,4,5],st=(t,e)=>({"bg-blue-600 hover:bg-blue-700 text-white":t,"bg-gray-200 text-gray-500 cursor-not-allowed opacity-70":e}),mt=(t,e)=>({"text-yellow-500":t,"text-gray-300":e});function lt(t,e){if(t&1){let i=L();he(0),f(1,"span",7),E("click",function(){let r=F(i).$implicit,o=_();return A(o.setRating(r))})("mouseenter",function(){let r=F(i).$implicit,o=_();return A(o.hoveredStar=r)})("mouseleave",function(){F(i);let r=_();return A(r.hoveredStar=0)}),l(2," \u2605 "),h(),we()}if(t&2){let i=e.$implicit,n=_();m(),ve("aria-label",_e("",i," star")),v("ngClass",ee(3,mt,i<=(n.hoveredStar||n.form.controls.star.value),i>(n.hoveredStar||n.form.controls.star.value)))}}var Xe=(()=>{var e,i;let n=class n{constructor(){x(this,e);x(this,i);this.fb=b(Le),R(this,e,b(H)),this.bookId=y.required(),R(this,i,b(W)),this.form=ze(this.fb),this.reviewAdded=Q(),this.hoveredStar=0,this.currentTab=w.reviews}get starCtrl(){return this.form.controls.star}get Readly(){return je}onSubmit(o){let a=sessionStorage.getItem(V.USER_STORAGE_KEY),c=a?JSON.parse(a):null;if(!c)return;let{comment:s,star:T}=this.form.getRawValue(),K={userId:c.id,userFullname:`${c.firstName} ${c.lastName}`,comment:s,rating:T,bookId:this.bookId()};if(Je(this.bookId())){u(this,i).showMessage({text:"\u10E3\u10D9\u10D5\u10D4 \u10D3\u10D0\u10DB\u10D0\u10E2\u10D4\u10D1\u10E3\u10DA\u10D8\u10D0 \u10D9\u10DD\u10DB\u10D4\u10DC\u10E2\u10D0\u10E0\u10D8 \u10D0\u10DB \u10EC\u10D8\u10D2\u10DC\u10D6\u10D4!",severity:O.Info});return}ne([K]).pipe(me(()=>u(this,e).addReview(K))).subscribe({next:()=>{this.formDir.resetForm(this.form.value),this.reviewAdded.emit(),u(this,i).showMessage({text:` ${K.userFullname} \u10EC\u10D0\u10E0\u10DB\u10D0\u10E2\u10D4\u10D1\u10D8\u10D7 \u10D3\u10D0\u10D0\u10DB\u10D0\u10E2\u10D0 \u10D9\u10DD\u10DB\u10D4\u10DC\u10E2\u10D0\u10E0\u10D8!`,severity:O.Success})}})}onReset(o){o.preventDefault(),this.formDir.reset(this.form.value)}setRating(o){this.form.controls.star.setValue(o)}};e=new WeakMap,i=new WeakMap,n.\u0275fac=function(a){return new(a||n)},n.\u0275cmp=g({type:n,selectors:[["app-add-review"]],viewQuery:function(a,c){if(a&1&&$(Y,5),a&2){let s;j(s=G())&&(c.formDir=s.first)}},inputs:{bookId:[1,"bookId"]},outputs:{reviewAdded:"reviewAdded"},decls:12,vars:7,consts:[[1,"max-w-xl","mx-auto","p-6","bg-white","shadow-lg","rounded-2xl","space-y-6","border","border-slate-200",3,"ngSubmit","reset","formGroup"],["label","Comment","formControlName","comment"],[1,"flex","items-center","gap-2"],["for","rating",1,"block","text-sm","font-medium","text-slate-700","mb-1","mr-2"],[1,"flex","justify-end","gap-3","pt-4","border-t","border-slate-200"],["type","reset",1,"px-4","py-2","text-sm","font-medium","rounded-lg","border","border-slate-300","text-slate-700","hover:bg-slate-100","transition"],["type","submit",1,"px-4","py-2","text-sm","font-medium","rounded-lg","transition","shadow",3,"disabled","ngClass"],["id","rating",1,"cursor-pointer","text-2xl","transition-colors","duration-200",3,"click","mouseenter","mouseleave","aria-label","ngClass"]],template:function(a,c){a&1&&(f(0,"form",0),E("ngSubmit",function(T){return c.onSubmit(T)})("reset",function(T){return c.onReset(T)}),k(1,"app-textarea",1),f(2,"div",2)(3,"label",3),l(4,"Rating:"),h(),M(5,lt,3,6,"ng-container",null,N),h(),f(7,"div",4)(8,"button",5),l(9," Reset "),h(),f(10,"button",6),l(11," Submit "),h()()()),a&2&&(v("formGroup",c.form),m(5),B(ye(3,at)),m(5),v("disabled",!c.form.valid)("ngClass",ee(4,st,c.form.valid,c.form.invalid)))},dependencies:[I,Ie,P,Ke,Oe,Ve,$e,Y,Ne,Qe,qe],encapsulation:2});let t=n;return t})();var dt=(t,e)=>e.userId;function pt(t,e){if(t&1&&(d(0,"article",1)(1,"figure",2)(2,"span",3),l(3,"person"),p()(),d(4,"section")(5,"header")(6,"h3",4),l(7),p()(),d(8,"p",5),l(9),p(),d(10,"p",6),l(11),p()()()),t&2){let i=e.$implicit;m(7),D(i.userFullname),m(2),Ee(" ","\u2605".repeat(i.rating),"","\u2606".repeat(5-i.rating)," "),m(2),S(" ",i.comment," ")}}var Ze=(()=>{let e=class e{constructor(){this.reviews=y.required()}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=g({type:e,selectors:[["app-review-list"]],inputs:{reviews:[1,"reviews"]},decls:3,vars:0,consts:[[1,"space-y-6"],[1,"flex","gap-4","p-4","bg-slate-50","rounded-lg","shadow-sm","hover:shadow","transition"],[1,"w-10","h-10","rounded-full","bg-slate-200","flex","items-center","justify-center"],["aria-hidden","true",1,"material-icons","text-slate-500"],[1,"font-semibold","text-slate-900"],["aria-label","User rating",1,"text-yellow-500","text-sm"],[1,"text-slate-700","text-sm","mt-1"]],template:function(r,o){r&1&&(d(0,"div",0),M(1,pt,12,4,"article",1,dt),p()),r&2&&(m(),B(o.reviews()))},encapsulation:2});let t=e;return t})();var J=(()=>{var e,i,n,r,o;let a=class a{constructor(){x(this,e,b(Re));x(this,i,b(Be));x(this,n,b(Ue));x(this,r,b(W));x(this,o,b(Ye))}tabs(s,T){return!s||!T?[]:[{key:w.reviews,label:w.reviews,template:s},{key:w.addReview,label:w.addReview,template:T}]}goBack(){(window.history.length>1?()=>u(this,e).back():()=>u(this,i).navigate(["/books"]))()}addToFavouritesEvent(s){let T={id:s.id,title:s.volumeInfo.title,authors:s.volumeInfo.authors,language:s.volumeInfo.language,imageLinks:{thumbnail:s.volumeInfo.imageLinks.thumbnail,smallThumbnail:s.volumeInfo.imageLinks.smallThumbnail},categories:s.volumeInfo.categories};u(this,n).addBookInFavourite(T),u(this,i).navigateByUrl("/favourites"),u(this,r).showMessage({text:`\u{1F4DA} "${s.volumeInfo.title}" \u10EC\u10D0\u10E0\u10DB\u10D0\u10E2\u10D4\u10D1\u10D8\u10D7 \u10D3\u10D0\u10D4\u10DB\u10D0\u10E2\u10D0 \u10D7\u10E5\u10D5\u10D4\u10DC\u10E1 \u10E4\u10D0\u10D5\u10DD\u10E0\u10D8\u10E2\u10D4\u10D1\u10E8\u10D8!`,severity:O.Success})}addToCatalogueEvent(s){u(this,o).addBook(s),u(this,i).navigateByUrl("/catalogue"),u(this,r).showMessage({text:`\u{1F4DA} "${s.volumeInfo.title}" \u10EC\u10D0\u10E0\u10DB\u10D0\u10E2\u10D4\u10D1\u10D8\u10D7 \u10D3\u10D0\u10D4\u10DB\u10D0\u10E2\u10D0 \u10D7\u10E5\u10D5\u10D4\u10DC\u10E1 \u10D9\u10D0\u10E2\u10D0\u10DA\u10DD\u10D2\u10E8\u10D8!`,severity:O.Success})}};e=new WeakMap,i=new WeakMap,n=new WeakMap,r=new WeakMap,o=new WeakMap,a.\u0275fac=function(T){return new(T||a)},a.\u0275prov=q({token:a,factory:a.\u0275fac,providedIn:"root"});let t=a;return t})();var et=(()=>{let e=class e{constructor(){this.isActive=!1}get classes(){return this.isActive?"border-blue-600 text-blue-600":"border-transparent text-slate-500 hover:text-slate-700 hover:border-slate-300"}};e.\u0275fac=function(r){return new(r||e)},e.\u0275dir=ce({type:e,selectors:[["","appTabActive",""]],hostVars:2,hostBindings:function(r,o){r&2&&Te(o.classes)},inputs:{isActive:[0,"appTabActive","isActive"]}});let t=e;return t})();var tt=(()=>{let e=class e{constructor(){this.currentTab=w.reviews,this.tabChange=new pe,this.TabKey=w}selectTab(n){this.tabChange.emit(n)}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=g({type:e,selectors:[["app-tabs"]],inputs:{currentTab:"currentTab"},outputs:{tabChange:"tabChange"},decls:5,vars:2,consts:[["aria-label","Tabs",1,"-mb-px","flex","space-x-6"],[1,"py-2","px-4","font-medium",3,"click","appTabActive"]],template:function(r,o){r&1&&(f(0,"nav",0)(1,"button",1),E("click",function(){return o.selectTab(o.TabKey.reviews)}),l(2," Reviews"),h(),f(3,"button",1),E("click",function(){return o.selectTab(o.TabKey.addReview)}),l(4," Add Review "),h()()),r&2&&(m(),v("appTabActive",o.currentTab===o.TabKey.reviews),m(2),v("appTabActive",o.currentTab===o.TabKey.addReview))},dependencies:[I,et],encapsulation:2});let t=e;return t})();var ct=["addReviewTemplate"],ut=["reviewsTemplate"],vt=t=>({$implicit:t});function ft(t,e){if(t&1&&(z(0,5),ke(1,"async")),t&2){let i=_(),n=Z(6);v("ngTemplateOutlet",n)("ngTemplateOutletContext",Ce(4,vt,Se(1,2,i.reviews$)))}}function bt(t,e){if(t&1&&z(0,6),t&2){_();let i=Z(8);v("ngTemplateOutlet",i)}}function gt(t,e){if(t&1&&k(0,"app-review-list",7),t&2){let i=e.$implicit;v("reviews",i)}}function ht(t,e){if(t&1){let i=L();f(0,"app-add-review",8),E("reviewAdded",function(){F(i);let r=_();return A(r.onReviewAdded())}),h()}if(t&2){let i=_();v("bookId",i.bookId())}}var ot=(()=>{var e,i;let n=class n{constructor(){x(this,e);x(this,i);R(this,e,b(J)),R(this,i,b(H)),this.bookId=y.required(),this.TabKey=w,this.currentTab=w.reviews}ngOnInit(){this.reviews$=u(this,i).loadReviewsByBookid(this.bookId()),this.reviews$.pipe(se(1)).subscribe(o=>{this.currentTab=o.length>0?w.reviews:w.addReview})}get tabs(){return u(this,e).tabs(this.reviewsTemplate,this.addReviewTemplate)}selectTab(o){this.currentTab=o}onReviewAdded(){this.currentTab=w.reviews}};e=new WeakMap,i=new WeakMap,n.\u0275fac=function(a){return new(a||n)},n.\u0275cmp=g({type:n,selectors:[["app-reviews-tab"]],viewQuery:function(a,c){if(a&1&&($(ct,5),$(ut,5)),a&2){let s;j(s=G())&&(c.addReviewTemplate=s.first),j(s=G())&&(c.reviewsTemplate=s.first)}},inputs:{bookId:[1,"bookId"]},decls:9,vars:2,consts:[["reviewsTemplate",""],["addReviewTemplate",""],[1,"border-b","border-slate-200","mb-6"],[3,"tabChange","currentTab"],[1,"tab-content","mt-6"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"ngTemplateOutlet"],[3,"reviews"],[3,"reviewAdded","bookId"]],template:function(a,c){if(a&1){let s=L();f(0,"div",2)(1,"app-tabs",3),E("tabChange",function(K){return F(s),A(c.selectTab(K))}),h()(),f(2,"div",4),fe(3,ft,2,6,"ng-container",5)(4,bt,1,1,"ng-container",6),h(),ue(5,gt,1,1,"ng-template",null,0,te)(7,ht,1,1,"ng-template",null,1,te)}if(a&2){let s;m(),v("currentTab",c.currentTab),m(2),be((s=c.currentTab)===c.TabKey.reviews?3:s===c.TabKey.addReview?4:-1)}},dependencies:[Xe,I,Fe,tt,Ze,Ae],encapsulation:2});let t=n;return t})();var Zo=(()=>{var e;let i=class i{constructor(){x(this,e);this.route=b(Me),R(this,e,b(J)),this.book=le(this.route.snapshot.data.book)}goBack(){u(this,e).goBack()}addToFavouritesEvent(){u(this,e).addToFavouritesEvent(this.book())}addToCatalogueEvent(){u(this,e).addToCatalogueEvent(this.book())}};e=new WeakMap,i.\u0275fac=function(o){return new(o||i)},i.\u0275cmp=g({type:i,selectors:[["app-book-details"]],decls:8,vars:3,consts:[[1,"max-w-6xl","mx-auto","my-10","bg-white","shadow-xl","rounded-2xl","border","border-slate-100","overflow-hidden"],[1,"flex","flex-col","md:flex-row"],[3,"book"],[1,"flex-1","p-8"],[3,"addToCatalogue","addToFavourites"],[3,"bookId"]],template:function(o,a){o&1&&(k(0,"app-back-button"),f(1,"div",0)(2,"div",1),k(3,"app-book-info",2),f(4,"div",3),k(5,"app-book-content",2),f(6,"app-book-actions",4),E("addToCatalogue",function(){return a.addToCatalogueEvent()})("addToFavourites",function(){return a.addToFavouritesEvent()}),h(),k(7,"app-reviews-tab",5),h()()()),o&2&&(m(3),v("book",a.book()),m(2),v("book",a.book()),m(2),v("bookId",a.book().id))},dependencies:[I,De,Ge,P,He,We,Pe,ot],encapsulation:2});let t=i;return t})();export{Zo as BookDetailsComponent};
