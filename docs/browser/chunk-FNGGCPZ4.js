import"./chunk-WZE2TEZU.js";import{a as Ke}from"./chunk-S4BWAZSI.js";import{a as $e,b as je}from"./chunk-3WZRPLP7.js";import{a as Le}from"./chunk-3HKYJRIY.js";import{a as Ge}from"./chunk-NKWI5ORP.js";import"./chunk-FWKQOSOW.js";import{a as Ne}from"./chunk-R3DW4DOA.js";import"./chunk-COCYGU5O.js";import"./chunk-6CWPCSKA.js";import"./chunk-HAAGQVTK.js";import"./chunk-EGZ4PNYR.js";import{A as De,C as W,D as Be,E as Oe,F as q,G as Ve,H as P,I as O,K as x,j as Se,l as Re,p as Ie,t as oe,w as Ae,x as Me}from"./chunk-ALFWPUQN.js";import"./chunk-C6HJTU6T.js";import{$b as k,Ab as N,Bb as A,Cb as M,Da as se,Db as h,Eb as v,Fb as g,Gb as y,Hb as d,Ib as p,Ic as ye,Jb as fe,Kb as be,Kc as Ce,Lb as ge,Mb as z,Mc as ke,Nb as L,Ob as he,Pb as T,Pc as R,Qb as X,R as ae,Rb as C,Sa as me,Tb as $,Ua as l,Ub as j,Vb as G,Vc as Fe,Wb as Z,Yb as we,Za as le,Zb as m,_b as D,ac as xe,d as u,e as w,f as S,fc as Ee,hc as Te,ia as Y,ib as b,ic as _e,jc as ee,kb as de,n as ie,na as f,nb as pe,nc as te,rc as U,s as ne,t as re,ta as I,ua as F,uc as Q,vc as B,wb as ce,yb as ue,zb as ve}from"./chunk-VG73PTL2.js";var Ue=(()=>{let e=class e{constructor(){this.addToFavourites=Q(),this.addToCatalogue=Q()}addToCatalogueEvent(){this.addToCatalogue.emit()}addToFavouritesEvent(){this.addToFavourites.emit()}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=b({type:e,selectors:[["app-book-actions"]],outputs:{addToFavourites:"addToFavourites",addToCatalogue:"addToCatalogue"},decls:9,vars:0,consts:[[1,"mt-6","mb-6","flex","flex-wrap","gap-3"],[1,"inline-flex","items-center","gap-2","px-6","py-2.5","rounded-lg","bg-pink-50","text-pink-700","text-sm","font-medium","border","border-pink-200","hover:bg-pink-100","transition","shadow-sm",3,"click"],[1,"material-icons","text-pink-600"],[1,"inline-flex","items-center","gap-2","px-6","py-2.5","rounded-lg","bg-slate-50","text-slate-800","text-sm","font-medium","border","border-slate-200","hover:bg-slate-100","transition","shadow-sm",3,"click"],[1,"material-icons","text-slate-600"]],template:function(r,o){r&1&&(d(0,"div",0)(1,"button",1),X("click",function(){return o.addToFavouritesEvent()}),d(2,"span",2),m(3,"favorite"),p(),m(4," Add to Favourites "),p(),d(5,"button",3),X("click",function(){return o.addToCatalogueEvent()}),d(6,"span",4),m(7,"library_add"),p(),m(8," Add to Catalogue "),p()())},encapsulation:2});let t=e;return t})();function Ze(t,e){if(t&1&&(d(0,"span",2),m(1),p()),t&2){let i=e.$implicit;l(),k(" ",i," ")}}function et(t,e){if(t&1&&(d(0,"span",5),m(1),p()),t&2){let i=e.$implicit;l(),k(" ",i," ")}}var Qe=(()=>{let e=class e{constructor(){this.book=B.required(),this.authorList=U(()=>this.book().volumeInfo.authors??[]),this.categoryList=U(()=>this.book().volumeInfo.categories??[])}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=b({type:e,selectors:[["app-book-content"]],inputs:{book:[1,"book"]},decls:10,vars:2,consts:[[1,"text-3xl","font-extrabold","text-slate-900"],[1,"mt-6","flex","flex-wrap","gap-2"],[1,"px-3","py-1","text-sm","font-medium","bg-blue-100","text-blue-800","rounded-full"],[1,"mt-4","text-slate-700","leading-relaxed","text-sm","md:text-base"],[1,"mt-5","flex","flex-wrap","gap-2"],[1,"px-2.5","py-1","text-xs","font-semibold","bg-green-100","text-green-700","rounded-full"]],template:function(r,o){r&1&&(d(0,"h1",0),m(1),p(),d(2,"div",1),A(3,Ze,2,1,"span",2,N),p(),d(5,"p",3),m(6),p(),d(7,"div",4),A(8,et,2,1,"span",5,N),p()),r&2&&(l(),k(" ",o.book().volumeInfo.title,`
`),l(2),M(o.authorList()),l(3),k(" ",o.book().volumeInfo.description,`
`),l(2),M(o.categoryList()))},encapsulation:2});let t=e;return t})();var Ye=(()=>{let e=class e{constructor(){this.book=B.required(),this.thumbnail=U(()=>this.book().volumeInfo.imageLinks?.thumbnail||this.book().volumeInfo.imageLinks?.smallThumbnail||"assets/default-thumbnail.png")}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=b({type:e,selectors:[["app-book-info"]],hostAttrs:[1,"md:w-1/3","bg-slate-50","p-6","flex","flex-col","items-center","md:items-start"],inputs:{book:[1,"book"]},decls:23,vars:6,consts:[[1,"w-full"],["loading","lazy",1,"w-full","h-auto","object-cover","rounded-lg","shadow-md",3,"src","alt"],[1,"sr-only"],[1,"mt-6","w-full"],[1,"text-lg","font-semibold","text-slate-900","mb-3"],[1,"space-y-2","text-sm","text-slate-700"],[1,"flex","justify-between"],[1,"font-medium","text-slate-900"],[1,"uppercase"]],template:function(r,o){r&1&&(d(0,"figure",0),fe(1,"img",1),d(2,"figcaption",2),m(3),p()(),d(4,"section",3)(5,"h2",4),m(6,"Book details"),p(),d(7,"ul",5)(8,"li",6)(9,"span",7),m(10,"Publisher:"),p(),d(11,"span"),m(12),p()(),d(13,"li",6)(14,"span",7),m(15,"Pages:"),p(),d(16,"span"),m(17),p()(),d(18,"li",6)(19,"span",7),m(20,"Language:"),p(),d(21,"span",8),m(22),p()()()()),r&2&&(l(),he("src",o.thumbnail(),me)("alt",o.book().volumeInfo.title),l(2),k(" ",o.book().volumeInfo.title," "),l(9),D(o.book().volumeInfo.publisher),l(5),D(o.book().volumeInfo.pageCount),l(5),D(o.book().volumeInfo.language))},encapsulation:2});let t=e;return t})();var V={BOOK_API:"https://www.googleapis.com/books/v1/volumes",CATALOGUE_STORAGE_KEY:"booksIncatalogue",FAVOURITE_STORAGE_KEY:"favouriteBooks",USER_STORAGE_KEY:"user",AUTH_API:"https://dummyjson.com/auth",ACCESS_TOKEN_KEY:"accessToken",REFRESH_TOKEN_KEY:"refreshToken",BOOK_REVIEWS:"BOOK_REVIEWS"};function We(t){let e=sessionStorage.getItem(V.BOOK_REVIEWS);return(e?JSON.parse(e):null)?.some(n=>n.userId===t)}var H=(()=>{let e=class e{constructor(){this.REVIEWS_KEY=V.BOOK_REVIEWS,this.reviews=new ie([]),this.reviews$=this.reviews.asObservable(),this.reviews.next(this.loadReviews()),window.addEventListener("storage",n=>{if(n.key===this.REVIEWS_KEY){let r=this.loadReviews();this.reviews.next(r)}})}loadReviews(){let n=sessionStorage.getItem(this.REVIEWS_KEY);return n?JSON.parse(n):[]}addReview(n){let r=this.reviews.value,o=[n,...r];return this.reviews.next(o),sessionStorage.setItem(this.REVIEWS_KEY,JSON.stringify(o)),re(!0)}};e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=Y({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();function qe(t){return t.nonNullable.group({comment:t.nonNullable.control("",[oe.maxLength(500),oe.required]),star:t.nonNullable.control(0)})}var ot=()=>[1,2,3,4,5],it=(t,e)=>({"bg-blue-600 hover:bg-blue-700 text-white":t,"bg-gray-200 text-gray-500 cursor-not-allowed opacity-70":e}),nt=(t,e)=>({"text-yellow-500":t,"text-gray-300":e});function rt(t,e){if(t&1){let i=L();be(0),v(1,"span",7),T("click",function(){let r=I(i).$implicit,o=C();return F(o.setRating(r))})("mouseenter",function(){let r=I(i).$implicit,o=C();return F(o.hoveredStar=r)})("mouseleave",function(){I(i);let r=C();return F(r.hoveredStar=0)}),m(2," \u2605 "),g(),ge()}if(t&2){let i=e.$implicit,n=C();l(),ce("aria-label",Ee("",i," star")),h("ngClass",ee(3,nt,i<=(n.hoveredStar||n.form.controls.star.value),i>(n.hoveredStar||n.form.controls.star.value)))}}var Pe=(()=>{var e,i;let n=class n{constructor(){w(this,e);w(this,i);this.fb=f(Oe),S(this,e,f(H)),S(this,i,f(P)),this.form=qe(this.fb),this.reviewAdded=Q(),this.hoveredStar=0,this.currentTab=x.reviews}get starCtrl(){return this.form.controls.star}get Readly(){return Ke}onSubmit(o){let a=sessionStorage.getItem(V.USER_STORAGE_KEY),c=a?JSON.parse(a):null;if(!c)return;let{comment:s,star:E}=this.form.getRawValue(),K={userId:c.id,userFullname:`${c.firstName} ${c.lastName}`,comment:s,rating:E};if(We(c.id)){u(this,i).showMessage({text:"\u10E3\u10D9\u10D5\u10D4 \u10D3\u10D0\u10DB\u10D0\u10E2\u10D4\u10D1\u10E3\u10DA\u10D8\u10D0 \u10D9\u10DD\u10DB\u10D4\u10DC\u10E2\u10D0\u10E0\u10D8!",severity:O.Info});return}ne([K]).pipe(ae(()=>u(this,e).addReview(K))).subscribe({next:()=>{this.formDir.resetForm(this.form.value),this.reviewAdded.emit(),u(this,i).showMessage({text:` ${K.userFullname} \u10EC\u10D0\u10E0\u10DB\u10D0\u10E2\u10D4\u10D1\u10D8\u10D7 \u10D3\u10D0\u10D0\u10DB\u10D0\u10E2\u10D0 \u10D9\u10DD\u10DB\u10D4\u10DC\u10E2\u10D0\u10E0\u10D8!`,severity:O.Success})}})}onReset(o){o.preventDefault(),this.formDir.reset(this.form.value)}setRating(o){this.form.controls.star.setValue(o)}};e=new WeakMap,i=new WeakMap,n.\u0275fac=function(a){return new(a||n)},n.\u0275cmp=b({type:n,selectors:[["app-add-review"]],viewQuery:function(a,c){if(a&1&&$(W,5),a&2){let s;j(s=G())&&(c.formDir=s.first)}},outputs:{reviewAdded:"reviewAdded"},decls:12,vars:7,consts:[[1,"max-w-xl","mx-auto","p-6","bg-white","shadow-lg","rounded-2xl","space-y-6","border","border-slate-200",3,"ngSubmit","reset","formGroup"],["label","Comment","formControlName","comment"],[1,"flex","items-center","gap-2"],["for","rating",1,"block","text-sm","font-medium","text-slate-700","mb-1","mr-2"],[1,"flex","justify-end","gap-3","pt-4","border-t","border-slate-200"],["type","reset",1,"px-4","py-2","text-sm","font-medium","rounded-lg","border","border-slate-300","text-slate-700","hover:bg-slate-100","transition"],["type","submit",1,"px-4","py-2","text-sm","font-medium","rounded-lg","transition","shadow",3,"disabled","ngClass"],["id","rating",1,"cursor-pointer","text-2xl","transition-colors","duration-200",3,"click","mouseenter","mouseleave","aria-label","ngClass"]],template:function(a,c){a&1&&(v(0,"form",0),T("ngSubmit",function(E){return c.onSubmit(E)})("reset",function(E){return c.onReset(E)}),y(1,"app-textarea",1),v(2,"div",2)(3,"label",3),m(4,"Rating:"),g(),A(5,rt,3,6,"ng-container",null,N),g(),v(7,"div",4)(8,"button",5),m(9," Reset "),g(),v(10,"button",6),m(11," Submit "),g()()()),a&2&&(h("formGroup",c.form),l(5),M(Te(3,ot)),l(5),h("disabled",!c.form.valid)("ngClass",ee(4,it,c.form.valid,c.form.invalid)))},dependencies:[R,Ce,q,De,Ae,Me,Ve,W,Be,$e,je],encapsulation:2});let t=n;return t})();var at=(t,e)=>e.userId;function st(t,e){if(t&1&&(d(0,"article",1)(1,"figure",2)(2,"span",3),m(3,"person"),p()(),d(4,"section")(5,"header")(6,"h3",4),m(7),p()(),d(8,"p",5),m(9),p(),d(10,"p",6),m(11),p()()()),t&2){let i=e.$implicit;l(7),D(i.userFullname),l(2),xe(" ","\u2605".repeat(i.rating),"","\u2606".repeat(5-i.rating)," "),l(2),k(" ",i.comment," ")}}var He=(()=>{let e=class e{constructor(){this.reviews=B.required()}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=b({type:e,selectors:[["app-review-list"]],inputs:{reviews:[1,"reviews"]},decls:3,vars:0,consts:[[1,"space-y-6"],[1,"flex","gap-4","p-4","bg-slate-50","rounded-lg","shadow-sm","hover:shadow","transition"],[1,"w-10","h-10","rounded-full","bg-slate-200","flex","items-center","justify-center"],["aria-hidden","true",1,"material-icons","text-slate-500"],[1,"font-semibold","text-slate-900"],["aria-label","User rating",1,"text-yellow-500","text-sm"],[1,"text-slate-700","text-sm","mt-1"]],template:function(r,o){r&1&&(d(0,"div",0),A(1,st,12,4,"article",1,at),p()),r&2&&(l(),M(o.reviews()))},encapsulation:2});let t=e;return t})();var J=(()=>{var e,i,n,r,o;let a=class a{constructor(){w(this,e,f(ye));w(this,i,f(Re));w(this,n,f(Le));w(this,r,f(P));w(this,o,f(Ge))}tabs(s,E){return!s||!E?[]:[{key:x.reviews,label:x.reviews,template:s},{key:x.addReview,label:x.addReview,template:E}]}goBack(){(window.history.length>1?()=>u(this,e).back():()=>u(this,i).navigate(["/books"]))()}addToFavouritesEvent(s){let E={id:s.id,title:s.volumeInfo.title,authors:s.volumeInfo.authors,language:s.volumeInfo.language,imageLinks:{thumbnail:s.volumeInfo.imageLinks.thumbnail,smallThumbnail:s.volumeInfo.imageLinks.smallThumbnail},categories:s.volumeInfo.categories};u(this,n).addBookInFavourite(E),u(this,i).navigateByUrl("/favourites"),u(this,r).showMessage({text:`\u{1F4DA} "${s.volumeInfo.title}" \u10EC\u10D0\u10E0\u10DB\u10D0\u10E2\u10D4\u10D1\u10D8\u10D7 \u10D3\u10D0\u10D4\u10DB\u10D0\u10E2\u10D0 \u10D7\u10E5\u10D5\u10D4\u10DC\u10E1 \u10E4\u10D0\u10D5\u10DD\u10E0\u10D8\u10E2\u10D4\u10D1\u10E8\u10D8!`,severity:O.Success})}addToCatalogueEvent(s){u(this,o).addBook(s),u(this,i).navigateByUrl("/catalogue"),u(this,r).showMessage({text:`\u{1F4DA} "${s.volumeInfo.title}" \u10EC\u10D0\u10E0\u10DB\u10D0\u10E2\u10D4\u10D1\u10D8\u10D7 \u10D3\u10D0\u10D4\u10DB\u10D0\u10E2\u10D0 \u10D7\u10E5\u10D5\u10D4\u10DC\u10E1 \u10D9\u10D0\u10E2\u10D0\u10DA\u10DD\u10D2\u10E8\u10D8!`,severity:O.Success})}};e=new WeakMap,i=new WeakMap,n=new WeakMap,r=new WeakMap,o=new WeakMap,a.\u0275fac=function(E){return new(E||a)},a.\u0275prov=Y({token:a,factory:a.\u0275fac,providedIn:"root"});let t=a;return t})();var Je=(()=>{let e=class e{constructor(){this.isActive=!1}get classes(){return this.isActive?"border-blue-600 text-blue-600":"border-transparent text-slate-500 hover:text-slate-700 hover:border-slate-300"}};e.\u0275fac=function(r){return new(r||e)},e.\u0275dir=de({type:e,selectors:[["","appTabActive",""]],hostVars:2,hostBindings:function(r,o){r&2&&we(o.classes)},inputs:{isActive:[0,"appTabActive","isActive"]}});let t=e;return t})();var ze=(()=>{let e=class e{constructor(){this.currentTab=x.reviews,this.tabChange=new le,this.TabKey=x}selectTab(n){this.tabChange.emit(n)}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=b({type:e,selectors:[["app-tabs"]],inputs:{currentTab:"currentTab"},outputs:{tabChange:"tabChange"},decls:5,vars:2,consts:[["aria-label","Tabs",1,"-mb-px","flex","space-x-6"],[1,"py-2","px-4","font-medium",3,"click","appTabActive"]],template:function(r,o){r&1&&(v(0,"nav",0)(1,"button",1),T("click",function(){return o.selectTab(o.TabKey.reviews)}),m(2," Reviews"),g(),v(3,"button",1),T("click",function(){return o.selectTab(o.TabKey.addReview)}),m(4," Add Review "),g()()),r&2&&(l(),h("appTabActive",o.currentTab===o.TabKey.reviews),l(2),h("appTabActive",o.currentTab===o.TabKey.addReview))},dependencies:[R,Je],encapsulation:2});let t=e;return t})();var mt=["addReviewTemplate"],lt=["reviewsTemplate"],dt=t=>({$implicit:t});function pt(t,e){if(t&1&&z(0,5),t&2){let i=C(),n=Z(6);h("ngTemplateOutlet",n)("ngTemplateOutletContext",_e(2,dt,i.reviews()))}}function ct(t,e){if(t&1&&z(0,6),t&2){C();let i=Z(8);h("ngTemplateOutlet",i)}}function ut(t,e){if(t&1&&y(0,"app-review-list",7),t&2){let i=e.$implicit;h("reviews",i)}}function vt(t,e){if(t&1){let i=L();v(0,"app-add-review",8),T("reviewAdded",function(){I(i);let r=C();return F(r.onReviewAdded())}),g()}}var Xe=(()=>{var e,i;let n=class n{constructor(){w(this,e);w(this,i);S(this,e,f(J)),S(this,i,f(H)),this.TabKey=x,this.currentTab=x.reviews,this.reviews=Fe(u(this,i).reviews)}ngOnInit(){let o=u(this,i).loadReviews();u(this,i).reviews.next(o)}get tabs(){return u(this,e).tabs(this.reviewsTemplate,this.addReviewTemplate)}selectTab(o){this.currentTab=o}onReviewAdded(){this.currentTab=x.reviews}};e=new WeakMap,i=new WeakMap,n.\u0275fac=function(a){return new(a||n)},n.\u0275cmp=b({type:n,selectors:[["app-reviews-tab"]],viewQuery:function(a,c){if(a&1&&($(mt,5),$(lt,5)),a&2){let s;j(s=G())&&(c.addReviewTemplate=s.first),j(s=G())&&(c.reviewsTemplate=s.first)}},decls:9,vars:2,consts:[["reviewsTemplate",""],["addReviewTemplate",""],[1,"border-b","border-slate-200","mb-6"],[3,"tabChange","currentTab"],[1,"tab-content","mt-6"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"ngTemplateOutlet"],[3,"reviews"],[3,"reviewAdded"]],template:function(a,c){if(a&1){let s=L();v(0,"div",2)(1,"app-tabs",3),T("tabChange",function(K){return I(s),F(c.selectTab(K))}),g()(),v(2,"div",4),ue(3,pt,1,4,"ng-container",5)(4,ct,1,1,"ng-container",6),g(),pe(5,ut,1,1,"ng-template",null,0,te)(7,vt,1,0,"ng-template",null,1,te)}if(a&2){let s;l(),h("currentTab",c.currentTab),l(2),ve((s=c.currentTab)===c.TabKey.reviews?3:s===c.TabKey.addReview?4:-1)}},dependencies:[Pe,R,ke,ze,He],encapsulation:2});let t=n;return t})();var Ho=(()=>{var e;let i=class i{constructor(){w(this,e);this.route=f(Se),S(this,e,f(J)),this.book=se(this.route.snapshot.data.book)}goBack(){u(this,e).goBack()}addToFavouritesEvent(){u(this,e).addToFavouritesEvent(this.book())}addToCatalogueEvent(){u(this,e).addToCatalogueEvent(this.book())}};e=new WeakMap,i.\u0275fac=function(o){return new(o||i)},i.\u0275cmp=b({type:i,selectors:[["app-book-details"]],decls:8,vars:2,consts:[[1,"max-w-6xl","mx-auto","my-10","bg-white","shadow-xl","rounded-2xl","border","border-slate-100","overflow-hidden"],[1,"flex","flex-col","md:flex-row"],[3,"book"],[1,"flex-1","p-8"],[3,"addToCatalogue","addToFavourites"]],template:function(o,a){o&1&&(y(0,"app-back-button"),v(1,"div",0)(2,"div",1),y(3,"app-book-info",2),v(4,"div",3),y(5,"app-book-content",2),v(6,"app-book-actions",4),T("addToCatalogue",function(){return a.addToCatalogueEvent()})("addToFavourites",function(){return a.addToFavouritesEvent()}),g(),y(7,"app-reviews-tab"),g()()()),o&2&&(l(3),h("book",a.book()),l(2),h("book",a.book()))},dependencies:[R,Ie,Ne,q,Ye,Qe,Ue,Xe],encapsulation:2});let t=i;return t})();export{Ho as BookDetailsComponent};
