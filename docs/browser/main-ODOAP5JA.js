import{a as We,b as ut}from"./chunk-JIPNBMU3.js";import{a as eo,b as no}from"./chunk-COCYGU5O.js";import{a as It,b as Et,c as St,d as ro}from"./chunk-HAAGQVTK.js";import{a as ft}from"./chunk-EGZ4PNYR.js";import{G as to,H as oo,I as Bt,a as Fe,b as Me,c as De,d as Pe,e as Le,f as Be,g as $e,h as Ne,i as _e,k as ze,l as $,o as Ue,q as N}from"./chunk-ALFWPUQN.js";import{a as _}from"./chunk-FSSWF45W.js";import{a as pt,b as G,c as lt,d as dt,e as Qe,f as mt,g as ht,h as gt}from"./chunk-C6HJTU6T.js";import{$ as Mt,$c as Ve,Aa as ot,B as jt,Ca as Te,Da as Oe,Gb as Dt,Ha as Ae,Hb as Ce,I as H,Ib as Re,J as b,Jb as we,K as C,L as ue,M as pe,O as D,P as le,Q as de,R as me,S as he,U as Ft,Vc as He,Wc as Ge,X as ge,Y as Ie,Yc as Pt,Z as Ee,Zc as st,_ as Se,_a as be,_c as Ke,a as S,aa as ve,ad as Ze,b as y,bd as Ye,ca as P,cd as Xe,d as W,da as tt,db as ke,dd as Lt,e as Qt,ea as X,ed as ct,f as te,fa as ye,fd as Je,g as ee,gd as k,ia as T,ib as nt,j as Y,jd as qe,kd as w,la as R,ld as at,m as oe,ma as x,na as u,o as ne,oa as et,p as re,pa as xe,pc as je,q as ie,r as se,s as ce,t as B,u as Q,x as ae,y as fe,yb as rt,z as E,zb as it}from"./chunk-VG73PTL2.js";var Qo={dispatch:!0,functional:!1,useEffectsErrorHandler:!0},vt="__@ngrx/effects_create__";function K(t,e={}){let r=e.functional?t:t(),o=S(S({},Qo),e);return Object.defineProperty(r,vt,{value:o}),r}function tn(t){return Object.getOwnPropertyNames(t).filter(o=>t[o]&&t[o].hasOwnProperty(vt)?t[o][vt].hasOwnProperty("dispatch"):!1).map(o=>{let n=t[o][vt];return S({propertyName:o},n)})}function en(t){return tn(t)}function so(t){return Object.getPrototypeOf(t)}function on(t){return!!t.constructor&&t.constructor.name!=="Object"&&t.constructor.name!=="Function"}function co(t){return typeof t=="function"}function nn(t){return t.filter(co)}function rn(t,e,r){let o=so(t),i=!!o&&o.constructor.name!=="Object"?o.constructor.name:null,c=en(t).map(({propertyName:p,dispatch:I,useEffectsErrorHandler:a})=>{let f=typeof t[p]=="function"?t[p]():t[p],s=a?r(f,e):f;return I===!1?s.pipe(le()):s.pipe(ge()).pipe(E(O=>({effect:t[p],notification:O,propertyName:p,sourceName:i,sourceInstance:t})))});return H(...c)}var sn=10;function ao(t,e,r=sn){return t.pipe(C(o=>(e&&e.handleError(o),r<=1?t:ao(t,e,r-1))))}var yt=(()=>{let e=class e extends Y{constructor(o){super(),o&&(this.source=o)}lift(o){let n=new e;return n.source=this,n.operator=o,n}};e.\u0275fac=function(n){return new(n||e)(x(ct))},e.\u0275prov=T({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();function V(...t){return b(e=>t.some(r=>typeof r=="string"?r===e.type:r.type===e.type))}var Wn=new R("@ngrx/effects Internal Root Guard"),Qn=new R("@ngrx/effects User Provided Effects"),tr=new R("@ngrx/effects Internal Root Effects"),er=new R("@ngrx/effects Internal Root Effects Instances"),or=new R("@ngrx/effects Internal Feature Effects"),nr=new R("@ngrx/effects Internal Feature Effects Instance Groups"),cn=new R("@ngrx/effects Effects Error Handler",{providedIn:"root",factory:()=>ao}),an="@ngrx/effects/init",fn=Ge(an);function un(t,e){if(t.notification.kind==="N"){let r=t.notification.value;!pn(r)&&e.handleError(new Error(`Effect ${ln(t)} dispatched an invalid action: ${dn(r)}`))}}function pn(t){return typeof t!="function"&&t&&t.type&&typeof t.type=="string"}function ln({propertyName:t,sourceInstance:e,sourceName:r}){let o=typeof e[t]=="function";return!!r?`"${r}.${String(t)}${o?"()":""}"`:`"${String(t)}()"`}function dn(t){try{return JSON.stringify(t)}catch{return t}}var mn="ngrxOnIdentifyEffects";function hn(t){return $t(t,mn)}var gn="ngrxOnRunEffects";function In(t){return $t(t,gn)}var En="ngrxOnInitEffects";function Sn(t){return $t(t,En)}function $t(t,e){return t&&e in t&&typeof t[e]=="function"}var fo=(()=>{let e=class e extends oe{constructor(o,n){super(),this.errorHandler=o,this.effectsErrorHandler=n}addEffects(o){this.next(o)}toActions(){return this.pipe(Ft(o=>on(o)?so(o):o),jt(o=>o.pipe(Ft(vn))),jt(o=>{let n=o.pipe(me(c=>yn(this.errorHandler,this.effectsErrorHandler)(c)),E(c=>(un(c,this.errorHandler),c.notification)),b(c=>c.kind==="N"&&c.value!=null),de()),i=o.pipe(D(1),b(Sn),E(c=>c.ngrxOnInitEffects()));return H(n,i)}))}};e.\u0275fac=function(n){return new(n||e)(x(ot),x(cn))},e.\u0275prov=T({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();function vn(t){return hn(t)?t.ngrxOnIdentifyEffects():""}function yn(t,e){return r=>{let o=rn(r,t,e);return In(r)?r.ngrxOnRunEffects(o):o}}var xn=(()=>{let e=class e{get isStarted(){return!!this.effectsSubscription}constructor(o,n){this.effectSources=o,this.store=n,this.effectsSubscription=null}start(){this.effectsSubscription||(this.effectsSubscription=this.effectSources.toActions().subscribe(this.store))}ngOnDestroy(){this.effectsSubscription&&(this.effectsSubscription.unsubscribe(),this.effectsSubscription=null)}};e.\u0275fac=function(n){return new(n||e)(x(fo),x(k))},e.\u0275prov=T({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();function uo(...t){let e=t.flat(),r=nn(e);return et([r,xe(()=>{u(Ve),u(Ze,{optional:!0});let o=u(xn),n=u(fo),i=!o.isStarted;i&&o.start();for(let c of e){let p=co(c)?u(c):c;n.addEffects(p)}i&&u(k).dispatch(fn())})])}var q="PERFORM_ACTION",Tn="REFRESH",Io="RESET",Eo="ROLLBACK",So="COMMIT",vo="SWEEP",yo="TOGGLE_ACTION",On="SET_ACTIONS_ACTIVE",xo="JUMP_TO_STATE",To="JUMP_TO_ACTION",qt="IMPORT_STATE",Oo="LOCK_CHANGES",Ao="PAUSE_RECORDING",Z=class{constructor(e,r){if(this.action=e,this.timestamp=r,this.type=q,typeof e.type>"u")throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?')}},Nt=class{constructor(){this.type=Tn}},_t=class{constructor(e){this.timestamp=e,this.type=Io}},zt=class{constructor(e){this.timestamp=e,this.type=Eo}},Ut=class{constructor(e){this.timestamp=e,this.type=So}},Ht=class{constructor(){this.type=vo}},Gt=class{constructor(e){this.id=e,this.type=yo}};var Kt=class{constructor(e){this.index=e,this.type=xo}},Vt=class{constructor(e){this.actionId=e,this.type=To}},Zt=class{constructor(e){this.nextLiftedState=e,this.type=qt}},Yt=class{constructor(e){this.status=e,this.type=Oo}},Xt=class{constructor(e){this.status=e,this.type=Ao}};var At=new R("@ngrx/store-devtools Options"),po=new R("@ngrx/store-devtools Initial Config");function bo(){return null}var An="NgRx Store DevTools";function bn(t){let e={maxAge:!1,monitor:bo,actionSanitizer:void 0,stateSanitizer:void 0,name:An,serialize:!1,logOnly:!1,autoPause:!1,trace:!1,traceLimit:75,features:{pause:!0,lock:!0,persist:!0,export:!0,import:"custom",jump:!0,skip:!0,reorder:!0,dispatch:!0,test:!0},connectInZone:!1},r=typeof t=="function"?t():t,o=r.logOnly?{pause:!0,export:!0,test:!0}:!1,n=r.features||o||e.features;n.import===!0&&(n.import="custom");let i=Object.assign({},e,{features:n},r);if(i.maxAge&&i.maxAge<2)throw new Error(`Devtools 'maxAge' cannot be less than 2, got ${i.maxAge}`);return i}function lo(t,e){return t.filter(r=>e.indexOf(r)<0)}function ko(t){let{computedStates:e,currentStateIndex:r}=t;if(r>=e.length){let{state:n}=e[e.length-1];return n}let{state:o}=e[r];return o}function J(t){return new Z(t,+Date.now())}function kn(t,e){return Object.keys(e).reduce((r,o)=>{let n=Number(o);return r[n]=Co(t,e[n],n),r},{})}function Co(t,e,r){return y(S({},e),{action:t(e.action,r)})}function Cn(t,e){return e.map((r,o)=>({state:Ro(t,r.state,o),error:r.error}))}function Ro(t,e,r){return t(e,r)}function wo(t){return t.predicate||t.actionsSafelist||t.actionsBlocklist}function Rn(t,e,r,o){let n=[],i={},c=[];return t.stagedActionIds.forEach((p,I)=>{let a=t.actionsById[p];a&&(I&&Wt(t.computedStates[I],a,e,r,o)||(i[p]=a,n.push(p),c.push(t.computedStates[I])))}),y(S({},t),{stagedActionIds:n,actionsById:i,computedStates:c})}function Wt(t,e,r,o,n){let i=r&&!r(t,e.action),c=o&&!e.action.type.match(o.map(I=>mo(I)).join("|")),p=n&&e.action.type.match(n.map(I=>mo(I)).join("|"));return i||c||p}function mo(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function jo(t){return{ngZone:t?u(be):null,connectInZone:t}}var bt=(()=>{let e=class e extends st{};e.\u0275fac=(()=>{let o;return function(i){return(o||(o=Ae(e)))(i||e)}})(),e.\u0275prov=T({token:e,factory:e.\u0275fac});let t=e;return t})(),xt={START:"START",DISPATCH:"DISPATCH",STOP:"STOP",ACTION:"ACTION"},Jt=new R("@ngrx/store-devtools Redux Devtools Extension"),Fo=(()=>{let e=class e{constructor(o,n,i){this.config=n,this.dispatcher=i,this.zoneConfig=jo(this.config.connectInZone),this.devtoolsExtension=o,this.createActionStreams()}notify(o,n){if(this.devtoolsExtension)if(o.type===q){if(n.isLocked||n.isPaused)return;let i=ko(n);if(wo(this.config)&&Wt(i,o,this.config.predicate,this.config.actionsSafelist,this.config.actionsBlocklist))return;let c=this.config.stateSanitizer?Ro(this.config.stateSanitizer,i,n.currentStateIndex):i,p=this.config.actionSanitizer?Co(this.config.actionSanitizer,o,n.nextActionId):o;this.sendToReduxDevtools(()=>this.extensionConnection.send(p,c))}else{let i=y(S({},n),{stagedActionIds:n.stagedActionIds,actionsById:this.config.actionSanitizer?kn(this.config.actionSanitizer,n.actionsById):n.actionsById,computedStates:this.config.stateSanitizer?Cn(this.config.stateSanitizer,n.computedStates):n.computedStates});this.sendToReduxDevtools(()=>this.devtoolsExtension.send(null,i,this.getExtensionConfig(this.config)))}}createChangesObservable(){return this.devtoolsExtension?new Y(o=>{let n=this.zoneConfig.connectInZone?this.zoneConfig.ngZone.runOutsideAngular(()=>this.devtoolsExtension.connect(this.getExtensionConfig(this.config))):this.devtoolsExtension.connect(this.getExtensionConfig(this.config));return this.extensionConnection=n,n.init(),n.subscribe(i=>o.next(i)),n.unsubscribe}):ie}createActionStreams(){let o=this.createChangesObservable().pipe(Se()),n=o.pipe(b(f=>f.type===xt.START)),i=o.pipe(b(f=>f.type===xt.STOP)),c=o.pipe(b(f=>f.type===xt.DISPATCH),E(f=>this.unwrapAction(f.payload)),ue(f=>f.type===qt?this.dispatcher.pipe(b(s=>s.type===Lt),fe(1e3),pe(1e3),E(()=>f),C(()=>B(f)),D(1)):B(f))),I=o.pipe(b(f=>f.type===xt.ACTION),E(f=>this.unwrapAction(f.payload))).pipe(tt(i)),a=c.pipe(tt(i));this.start$=n.pipe(tt(i)),this.actions$=this.start$.pipe(P(()=>I)),this.liftedActions$=this.start$.pipe(P(()=>a))}unwrapAction(o){return typeof o=="string"?(0,eval)(`(${o})`):o}getExtensionConfig(o){let n={name:o.name,features:o.features,serialize:o.serialize,autoPause:o.autoPause??!1,trace:o.trace??!1,traceLimit:o.traceLimit??75};return o.maxAge!==!1&&(n.maxAge=o.maxAge),n}sendToReduxDevtools(o){try{o()}catch(n){console.warn("@ngrx/store-devtools: something went wrong inside the redux devtools",n)}}};e.\u0275fac=function(n){return new(n||e)(x(Jt),x(At),x(bt))},e.\u0275prov=T({token:e,factory:e.\u0275fac});let t=e;return t})(),Ot={type:Pt},wn="@ngrx/store-devtools/recompute",jn={type:wn};function Mo(t,e,r,o,n){if(o)return{state:r,error:"Interrupted by an error up the chain"};let i=r,c;try{i=t(r,e)}catch(p){c=p.toString(),n.handleError(p)}return{state:i,error:c}}function Tt(t,e,r,o,n,i,c,p,I){if(e>=t.length&&t.length===i.length)return t;let a=t.slice(0,e),f=i.length-(I?1:0);for(let s=e;s<f;s++){let d=i[s],O=n[d].action,m=a[s-1],l=m?m.state:o,F=m?m.error:void 0,M=c.indexOf(d)>-1?m:Mo(r,O,l,F,p);a.push(M)}return I&&a.push(t[t.length-1]),a}function Fn(t,e){return{monitorState:e(void 0,{}),nextActionId:1,actionsById:{0:J(Ot)},stagedActionIds:[0],skippedActionIds:[],committedState:t,currentStateIndex:0,computedStates:[],isLocked:!1,isPaused:!1}}function Mn(t,e,r,o,n={}){return i=>(c,p)=>{let{monitorState:I,actionsById:a,nextActionId:f,stagedActionIds:s,skippedActionIds:d,committedState:O,currentStateIndex:m,computedStates:l,isLocked:F,isPaused:A}=c||e;c||(a=Object.create(a));function M(v){let g=v,L=s.slice(1,g+1);for(let j=0;j<L.length;j++)if(l[j+1].error){g=j,L=s.slice(1,g+1);break}else delete a[L[j]];d=d.filter(j=>L.indexOf(j)===-1),s=[0,...s.slice(g+1)],O=l[g].state,l=l.slice(g),m=m>g?m-g:0}function U(){a={0:J(Ot)},f=1,s=[0],d=[],O=l[m].state,m=0,l=[]}let h=0;switch(p.type){case Oo:{F=p.status,h=1/0;break}case Ao:{A=p.status,A?(s=[...s,f],a[f]=new Z({type:"@ngrx/devtools/pause"},+Date.now()),f++,h=s.length-1,l=l.concat(l[l.length-1]),m===s.length-2&&m++,h=1/0):U();break}case Io:{a={0:J(Ot)},f=1,s=[0],d=[],O=t,m=0,l=[];break}case So:{U();break}case Eo:{a={0:J(Ot)},f=1,s=[0],d=[],m=0,l=[];break}case yo:{let{id:v}=p;d.indexOf(v)===-1?d=[v,...d]:d=d.filter(L=>L!==v),h=s.indexOf(v);break}case On:{let{start:v,end:g,active:L}=p,j=[];for(let wt=v;wt<g;wt++)j.push(wt);L?d=lo(d,j):d=[...d,...j],h=s.indexOf(v);break}case xo:{m=p.index,h=1/0;break}case To:{let v=s.indexOf(p.actionId);v!==-1&&(m=v),h=1/0;break}case vo:{s=lo(s,d),d=[],m=Math.min(m,s.length-1);break}case q:{if(F)return c||e;if(A||c&&Wt(c.computedStates[m],p,n.predicate,n.actionsSafelist,n.actionsBlocklist)){let g=l[l.length-1];l=[...l.slice(0,-1),Mo(i,p.action,g.state,g.error,r)],h=1/0;break}n.maxAge&&s.length===n.maxAge&&M(1),m===s.length-1&&m++;let v=f++;a[v]=p,s=[...s,v],h=s.length-1;break}case qt:{({monitorState:I,actionsById:a,nextActionId:f,stagedActionIds:s,skippedActionIds:d,committedState:O,currentStateIndex:m,computedStates:l,isLocked:F,isPaused:A}=p.nextLiftedState);break}case Pt:{h=0,n.maxAge&&s.length>n.maxAge&&(l=Tt(l,h,i,O,a,s,d,r,A),M(s.length-n.maxAge),h=1/0);break}case Lt:{if(l.filter(g=>g.error).length>0)h=0,n.maxAge&&s.length>n.maxAge&&(l=Tt(l,h,i,O,a,s,d,r,A),M(s.length-n.maxAge),h=1/0);else{if(!A&&!F){m===s.length-1&&m++;let g=f++;a[g]=new Z(p,+Date.now()),s=[...s,g],h=s.length-1,l=Tt(l,h,i,O,a,s,d,r,A)}l=l.map(g=>y(S({},g),{state:i(g.state,jn)})),m=s.length-1,n.maxAge&&s.length>n.maxAge&&M(s.length-n.maxAge),h=1/0}break}default:{h=1/0;break}}return l=Tt(l,h,i,O,a,s,d,r,A),I=o(I,p),{monitorState:I,actionsById:a,nextActionId:f,stagedActionIds:s,skippedActionIds:d,committedState:O,currentStateIndex:m,computedStates:l,isLocked:F,isPaused:A}}}var ho=(()=>{let e=class e{constructor(o,n,i,c,p,I,a,f){let s=Fn(a,f.monitor),d=Mn(a,s,I,f.monitor,f),O=H(H(n.asObservable().pipe(ve(1)),c.actions$).pipe(E(J)),o,c.liftedActions$).pipe(se(re)),m=i.pipe(E(d)),l=jo(f.connectInZone),F=new ne(1);this.liftedStateSubscription=O.pipe(ye(m),go(l),Ee(({state:U},[h,v])=>{let g=v(U,h);return h.type!==q&&wo(f)&&(g=Rn(g,f.predicate,f.actionsSafelist,f.actionsBlocklist)),c.notify(h,g),{state:g,action:h}},{state:s,action:null})).subscribe(({state:U,action:h})=>{if(F.next(U),h.type===q){let v=h.action;p.next(v)}}),this.extensionStartSubscription=c.start$.pipe(go(l)).subscribe(()=>{this.refresh()});let A=F.asObservable(),M=A.pipe(E(ko));Object.defineProperty(M,"state",{value:He(M,{manualCleanup:!0,requireSync:!0})}),this.dispatcher=o,this.liftedState=A,this.state=M}ngOnDestroy(){this.liftedStateSubscription.unsubscribe(),this.extensionStartSubscription.unsubscribe()}dispatch(o){this.dispatcher.next(o)}next(o){this.dispatcher.next(o)}error(o){}complete(){}performAction(o){this.dispatch(new Z(o,+Date.now()))}refresh(){this.dispatch(new Nt)}reset(){this.dispatch(new _t(+Date.now()))}rollback(){this.dispatch(new zt(+Date.now()))}commit(){this.dispatch(new Ut(+Date.now()))}sweep(){this.dispatch(new Ht)}toggleAction(o){this.dispatch(new Gt(o))}jumpToAction(o){this.dispatch(new Vt(o))}jumpToState(o){this.dispatch(new Kt(o))}importState(o){this.dispatch(new Zt(o))}lockChanges(o){this.dispatch(new Yt(o))}pauseRecording(o){this.dispatch(new Xt(o))}};e.\u0275fac=function(n){return new(n||e)(x(bt),x(st),x(Ye),x(Fo),x(ct),x(ot),x(Ke),x(At))},e.\u0275prov=T({token:e,factory:e.\u0275fac});let t=e;return t})();function go({ngZone:t,connectInZone:e}){return r=>e?new Y(o=>r.subscribe({next:n=>t.run(()=>o.next(n)),error:n=>t.run(()=>o.error(n)),complete:()=>t.run(()=>o.complete())})):r}var Dn=new R("@ngrx/store-devtools Is Devtools Extension or Monitor Present");function Pn(t,e){return!!t||e.monitor!==bo}function Ln(){let t="__REDUX_DEVTOOLS_EXTENSION__";return typeof window=="object"&&typeof window[t]<"u"?window[t]:null}function Bn(t){return t.state}function Do(t={}){return et([Fo,bt,ho,{provide:po,useValue:t},{provide:Dn,deps:[Jt,At],useFactory:Pn},{provide:Jt,useFactory:Ln},{provide:At,deps:[po],useFactory:bn},{provide:Je,deps:[ho],useFactory:Bn},{provide:Xe,useExisting:bt}])}var Po=(()=>{let e=class e{constructor(){this.actions$=u(yt),this.authService=u(ut),this.login$=K(()=>this.actions$.pipe(V(pt),P(({username:o,password:n})=>this.authService.login(o,n).pipe(X(i=>{sessionStorage.setItem(N.ACCESS_TOKEN_KEY,i.accessToken),sessionStorage.setItem(N.REFRESH_TOKEN_KEY,i.refreshToken),sessionStorage.setItem(N.USER_STORAGE_KEY,JSON.stringify(i.user))}),E(i=>G({user:i.user,tokens:{accessToken:i.accessToken,refreshToken:i.refreshToken}})),C(i=>B(lt({error:i.message||"Login failed"}))))))),this.logout$=K(()=>this.actions$.pipe(V(dt),X(()=>this.authService.logout())),{dispatch:!1}),this.userProfile$=K(()=>this.actions$.pipe(V(Qe),P(()=>this.authService.getProfile().pipe(E(o=>mt({user:o})),C(o=>B(ht({error:o.message||"Failed to fetch profile"})))))))}};e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=T({token:e,factory:e.\u0275fac});let t=e;return t})();var $n={user:null,tokens:null,isLoggedIn:!1,loading:!1,error:null,userProfile:null},Lo=at($n,w(pt,t=>y(S({},t),{isLoggedIn:!1,loading:!0})),w(G,(t,{user:e,tokens:r})=>y(S({},t),{user:e,tokens:r,isLoggedIn:!0,loading:!1})),w(lt,(t,{error:e})=>y(S({},t),{error:e,loading:!1})),w(dt,t=>y(S({},t),{user:null,tokens:null,isLoggedIn:!1,loading:!1,error:null})),w(gt,(t,{tokens:e})=>y(S({},t),{tokens:e})),w(mt,(t,{user:e})=>y(S({},t),{userProfile:e,isLoggedIn:!0})),w(ht,(t,{error:e})=>y(S({},t),{error:e,isLoggedIn:!1,user:null})));var kt=new Me(()=>!1);var Ct=(()=>{let e=class e{constructor(){this.http=u(Pe),this.BOOK_API=N.BOOK_API}searchBooksByName(o,n,i){return this.http.get(`${this.BOOK_API}?q=${o}&maxResults=${n}&startIndex=${i}`).pipe(E(c=>({items:(c.items||[]).map(a=>({id:a.id,title:a.volumeInfo.title,authors:a.volumeInfo.authors||[],imageLinks:a.volumeInfo.imageLinks||{thumbnail:"",smallThumbnail:""},language:a.volumeInfo.language||"",categories:a.volumeInfo.categories})),totalItems:c.totalItems||0})),Mt(1))}loadBooksByCategory(o,n,i){return this.http.get(`${this.BOOK_API}?q=${o}&maxResults=${n}&startIndex=${i}`).pipe(E(c=>({items:(c.items||[]).map(a=>({id:a.id,title:a.volumeInfo.title,authors:a.volumeInfo.authors||[],imageLinks:a.volumeInfo.imageLinks||{thumbnail:"",smallThumbnail:""},language:a.volumeInfo.language||"",categories:a.volumeInfo.categories})),totalItems:c.totalItems||0})),Mt(1))}bookById(o){return this.http.get(`${this.BOOK_API}/${o}`,{context:new De().set(kt,!0)}).pipe(E(n=>{let i=n.volumeInfo;return{id:n.id,saleInfo:S({},n.saleInfo),volumeInfo:y(S({},n.volumeInfo),{publisher:i?.publisher||"",publishedDate:i?.publishedDate||"",description:i?.description||"",pageCount:i?.pageCount||0,printType:i?.printType||"",categories:i?.categories||[],previewLink:i?.previewLink||""})}}))}};e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=T({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();var Bo=t=>ee(null,null,function*(){let e=t.paramMap.get("id"),r=u(Ct),o=u($);if(!e)return o.navigate(["/books"]),Promise.reject("No BookId");try{let n=yield ae(r.bookById(e));return n||(o.navigate(["/books"]),Promise.reject("Book not found"))}catch(n){return o.navigate(["/books"]),Promise.reject(n)}});var $o=[{path:"",loadComponent:()=>import("./chunk-XYFB4IP7.js").then(t=>t.HomeComponent)},{path:":id",loadComponent:()=>import("./chunk-FNGGCPZ4.js").then(t=>t.BookDetailsComponent),resolve:{book:Bo},data:{}}];var No=()=>{let t=u(k),e=u($);return t.select(_).pipe(b(r=>r!=null),D(1),E(r=>r?!0:e.parseUrl("/login")))};var _o=()=>{let t=u(k),e=u($);return t.select(_).pipe(D(1),E(r=>r?e.parseUrl("/books"):!0))};var zo=()=>{let t=u(k),e=u($);return t.select(_).pipe(b(r=>r!=null),D(1),E(r=>e.parseUrl(r?"books":"login")))};var Uo=[{path:"",canActivate:[zo],loadComponent:()=>import("./chunk-VRHIPSOT.js").then(t=>t.LoginComponent),pathMatch:"full"},{path:"",canActivate:[No],children:[{path:"books",children:$o},{path:"favourites",loadComponent:()=>import("./chunk-M6S2A33L.js").then(t=>t.WishlistComponent)},{path:"catalogue",loadComponent:()=>import("./chunk-637WWM3L.js").then(t=>t.CataloguesComponent)},{path:"profile",loadComponent:()=>import("./chunk-YR7C4GZA.js").then(t=>t.ProfileComponent)}]},{path:"login",loadComponent:()=>import("./chunk-VRHIPSOT.js").then(t=>t.LoginComponent),canActivate:[_o]},{path:"**",redirectTo:""}];var Ho=(t,e)=>{let r=u(We),o=u(ft),n=u(k),i=o.getRefreshToken(),c=o.getAccessToken(),I=["/auth/me"].some(f=>t.url.includes(f)),a=I&&c?t.clone({setHeaders:{Authorization:`Bearer ${c}`}}):t;return e(a).pipe(C(f=>f.status===401&&i&&I?ce(r.refresh(i)).pipe(P(s=>{o.saveTokens(s.accessToken,s.refreshToken),n.dispatch(gt({tokens:s}));let d=t.clone({setHeaders:{Authorization:`Bearer ${s.accessToken}`}});return e(d)})):Q(()=>f)))};var Go=(t,e)=>{let r=u(oo);return e(t).pipe(Ie({count:3,delay:1e3}),X({error:o=>{r.showMessage({text:o.message,severity:Bt.Error,duration:5e3})}}),C(o=>{let n=o.error?.message??"Unexpected error";return r.showMessage({text:n,severity:Bt.Error,duration:5e3}),Q(()=>o)}))};var Rt=(()=>{var e;let r=class r{constructor(){Qt(this,e);te(this,e,Oe(!1)),this.loading=W(this,e).asReadonly()}loadingOn(){W(this,e).set(!0)}loadingOff(){W(this,e).set(!1)}};e=new WeakMap,r.\u0275fac=function(i){return new(i||r)},r.\u0275prov=T({token:r,factory:r.\u0275fac,providedIn:"root"});let t=r;return t})();var Ko=(t,e)=>{if(t.context.get(kt))return e(t);let r=u(Rt);return r.loadingOn(),e(t).pipe(he(()=>{r.loadingOff()}))};var Vo=(()=>{let e=class e{constructor(){this.actions$=u(yt),this.bookService=u(Ct),this.loadBooks$=K(()=>this.actions$.pipe(V(It),P(o=>(o.query.length>3?this.bookService.searchBooksByName(o.query,o.maxResults,o.startIndex):this.bookService.loadBooksByCategory(o.query,o.maxResults,o.startIndex)).pipe(E(i=>Et({books:i,maxResults:o.maxResults,startIndex:o.startIndex})),C(i=>B(St({error:i.message})))))))}};e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=T({token:e,factory:e.\u0275fac});let t=e;return t})();var Nn={items:[],totalItems:0,loading:!1,error:null,currentPage:1,maxResults:10,windowSize:5,startIndex:0},Zo=at(Nn,w(It,t=>y(S({},t),{loading:!0,error:null})),w(Et,(t,{books:e,maxResults:r,startIndex:o})=>y(S({},t),{items:e.items,totalItems:e.totalItems,maxResults:r,currentPage:o+1,startIndex:o,loading:!1,error:null})),w(St,(t,{error:e})=>y(S({},t),{items:[],totalItems:0,loading:!1,error:e})),w(ro,(t,{page:e})=>y(S({},t),{currentPage:e})));var Yo={providers:[Te(),je({eventCoalescing:!0}),Ue(Uo),_e(Ne()),Le($e(),Be([Ho,Ko,Go])),qe({auth:Lo,books:Zo}),uo([Po,Vo]),Do({maxAge:25,logOnly:!1})]};function _n(t,e){t&1&&(Ce(0,"div",0),we(1,"div",1),Re())}var Xo=(()=>{let e=class e{constructor(){this.loadingService=u(Rt),this.loading=this.loadingService.loading}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=nt({type:e,selectors:[["app-loading"]],decls:1,vars:1,consts:[[1,"fixed","inset-0","flex","items-center","justify-center","bg-white/60","z-[1000]"],[1,"h-8","w-8","sm:h-10","sm:w-10","border-4","border-blue-500","border-t-transparent","rounded-full","animate-spin"]],template:function(n,i){n&1&&rt(0,_n,2,0,"div",0),n&2&&it(i.loading()?0:-1)},encapsulation:2});let t=e;return t})();function zn(t,e){t&1&&Dt(0,"app-header")}var Jo=(()=>{let e=class e{constructor(o){this.store=o,this.isLoggedIn=!1,this.authService=u(ut),this.tokenStorageService=u(ft),this.store.select(_).subscribe(n=>{this.isLoggedIn=n}),this.init()}init(){let o=this.tokenStorageService.getAccessToken(),n=this.tokenStorageService.getRefreshToken(),i=sessionStorage.getItem(N.USER_STORAGE_KEY),c=i?JSON.parse(i):null;o&&n&&c&&this.store.dispatch(G({user:c,tokens:{accessToken:o,refreshToken:n}}))}};e.\u0275fac=function(n){return new(n||e)(ke(k))},e.\u0275cmp=nt({type:e,selectors:[["app-root"]],decls:4,vars:1,template:function(n,i){n&1&&(rt(0,zn,1,0,"app-header"),Dt(1,"app-loading")(2,"app-messages")(3,"router-outlet")),n&2&&it(i.isLoggedIn?0:-1)},dependencies:[ze,to,Xo,eo,no],encapsulation:2});let t=e;return t})();Fe(Jo,Yo).catch(t=>console.error(t));
